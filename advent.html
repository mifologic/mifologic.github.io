<!doctype html>
<html lang="ru">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Адвент: забота о себе</title>
<style>
  :root{
    --bg:#f7f4f2;
    --card:#fff;
    --accent:#6b4f9f;
    --muted:#7a7a7a;
    --ok:#2a9d8f;
    --shadow: 0 6px 18px rgba(12,12,12,0.08);
    font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
  }
  html,body{height:100%;margin:0;background:linear-gradient(180deg,var(--bg),#eef0f2 100%);color:#222}
  .wrap{max-width:980px;margin:28px auto;padding:18px;}
  header{display:flex;align-items:center;justify-content:space-between;gap:12px}
  h1{font-size:20px;margin:0;color:var(--accent)}
  p.lead{margin:6px 0 18px;color:var(--muted);font-size:14px}
  .grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(120px,1fr));gap:14px}
  .card{
    perspective:800px;
    height:140px;
  }
  .inner{
    position:relative;width:100%;height:100%;border-radius:10px;background:var(--card);
    box-shadow:var(--shadow);cursor:pointer;transform-style:preserve-3d;transition:transform .6s;
  }
  .card.open .inner{transform:rotateY(180deg)}
  .face{
    position:absolute;inset:0;backface-visibility:hidden;border-radius:10px;display:flex;align-items:center;justify-content:center;padding:12px;
  }
  .front{
    background:linear-gradient(180deg,#fff,var(--card));font-weight:700;color:var(--accent);font-size:22px;
  }
  .front .num{font-size:32px}
  .back{
    transform:rotateY(180deg);text-align:left;padding:12px 14px;font-size:14px;color:#222;
    display:flex;flex-direction:column;gap:8px;justify-content:space-between;
  }
  .task{line-height:1.3}
  .controls{display:flex;gap:8px;align-items:center;justify-content:space-between}
  .btn{
    padding:8px 10px;border-radius:8px;border:0;background:var(--accent);color:white;font-weight:600;cursor:pointer;
    box-shadow:0 4px 10px rgba(107,79,159,0.15);
  }
  .btn.secondary{background:#eee;color:#333;font-weight:600}
  .small{font-size:13px;color:var(--muted)}
  .done{display:inline-flex;align-items:center;gap:8px;font-size:13px}
  .done input{width:18px;height:18px}
  footer{margin-top:18px;display:flex;align-items:center;justify-content:space-between;gap:10px}
  .progress{font-size:13px;color:var(--muted)}
  .reset{background:transparent;border:0;color:var(--muted);cursor:pointer;text-decoration:underline;font-size:13px}
  .separator{margin:22px 0;border-top:1px dashed rgba(0,0,0,0.06);padding-top:12px}
  .section-title{font-size:15px;color:var(--muted);margin:6px 0 12px}
  @media (max-width:520px){
    .card{height:120px}
    .front .num{font-size:26px}
  }
  /* print-friendly */
  @media print{
    body{background:white}
    .btn,.reset{display:none}
    .inner{box-shadow:none}
    .grid{gap:6px}
    .card{page-break-inside:avoid;break-inside:avoid;}
  }
</style>
</head>
<body>
  <div class="wrap" role="main">
    <header>
      <div>
        <h1>Адвент — забота о себе (короткие задания)</h1>
        <p class="lead">Кликни на окошко дня, чтобы открыть задание. Каждое занимает 1–5 минут. Прогресс сохраняется в этом браузере.</p>
      </div>
      <div style="text-align:right">
        <div class="small">Подходит для быстрых пауз и мягкой рефлексии</div>
        <div style="height:6px"></div>
        <button class="btn" id="revealToday">Открыть сегодня</button>
      </div>
    </header>

    <!-- Основные 1–24 -->
    <section>
      <div class="grid" id="grid" aria-live="polite"></div>
    </section>

    <div class="separator" role="separator" aria-hidden="false">
      <div class="section-title">Бонусные дни — 25–31</div>
      <div class="grid" id="bonusGrid" aria-live="polite"></div>
    </div>

    <footer>
      <div class="progress" id="progress">Открыто 0 из 31</div>
      <div style="display:flex;gap:8px;align-items:center">
        <button class="btn secondary" id="printBtn">Печать</button>
        <button class="reset" id="resetBtn">Сбросить прогресс</button>
      </div>
    </footer>
  </div>

<script>
(function(){
  const mainTasks = [
    "Запиши одну вещь, которая в тебе укрепилась за год.",
    "Выбери маленький жест заботы о теле: выпей воды, сделай 3 глубоких вдоха, потянись.",
    "Вспомни момент, когда ты собой гордилась, и опиши его тремя словами.",
    "Устроить «паузу на окно» на 2 минуты — просто смотреть и дышать.",
    "Подумать, кто была опорой в этом году, и мысленно поблагодарить.",
    "Записать одну привычку, которую хочешь мягко укрепить в следующем году.",
    "Сделать маленькую сенсорную радость: тёплый напиток, любимый запах, плед.",
    "Выбрать фото за год, которое хочется сохранить как символ тёплого момента.",
    "Положить руку на грудь и сделать 5 глубоких медленных вдохов.",
    "Спросить себя: «Что мне нужно прямо сейчас?» — и выполнить минимальный шаг.",
    "Записать три маленьких удачи этого года.",
    "Остаться в прямой осанке 1 минуту — почувствовать дыхание.",
    "Устроить «тишину на 1 минуту» — без телефона и задач.",
    "Выписать три вещи, которые хочешь оставить в уходящем году.",
    "Вспомнить человека, которому принесла добро, даже мелкое.",
    "Выбрать одно упрощение для сегодняшнего дня.",
    "Записать одну мечту без обязательств — просто как возможность.",
    "Микро-расхламление: убрать или отдать одну вещь.",
    "Составить мини-плейлист из трёх треков, которые дают опору.",
    "Вспомнить момент покоя за год — описать телесное ощущение.",
    "Проверить базовые потребности: голод, вода, воздух — удовлетворить одну.",
    "Записать маленькое «да», которое ты в этом году сказала себе.",
    "Сделать 30 секунд растяжки: шея, плечи или спина.",
    "Назвать одну вещь, которую ты сделаешь для себя в новом году в первую очередь."
  ];

  const bonusTasks = [
    "Мягкое завершение дня — выбери один жест ласки себе.",
    "Запиши три события года, которые сделали тебя сильнее.",
    "Две минуты тишины — просто побыть внутри.",
    "Подарок себе: придумай маленький символический жест.",
    "Что хочешь отпустить перед новым годом? Напиши одно слово.",
    "Что хочешь пригласить в новую версию себя? Напиши одно качество.",
    "Напиши тёплое письмо себе на следующий год (коротко)."
  ];

  const grid = document.getElementById('grid');
  const bonusGrid = document.getElementById('bonusGrid');
  const progressEl = document.getElementById('progress');
  const resetBtn = document.getElementById('resetBtn');
  const printBtn = document.getElementById('printBtn');
  const revealTodayBtn = document.getElementById('revealToday');

  // State saved as arrays keyed by index 0..30
  const STORAGE_KEY = 'advent-selfcare-state-v2';
  let state = { opened: {}, done: {} };
  try{
    const raw = localStorage.getItem(STORAGE_KEY);
    if(raw) state = JSON.parse(raw);
  }catch(e){ console.warn(e) }

  function save(){ localStorage.setItem(STORAGE_KEY, JSON.stringify(state)); updateProgress(); }

  function createCard(globalIndex, label, text){
    // globalIndex: 0..30 (day-1)
    const card = document.createElement('div');
    card.className = 'card';
    card.setAttribute('data-day', globalIndex + 1);
    card.setAttribute('role','group');
    card.setAttribute('aria-label','День ' + (globalIndex + 1));

    const inner = document.createElement('div');
    inner.className = 'inner';

    const front = document.createElement('div');
    front.className = 'face front';
    front.innerHTML = '<div><div class="num">' + label + '</div></div>';

    const back = document.createElement('div');
    back.className = 'face back';
    const task = document.createElement('div'); task.className = 'task'; task.textContent = text;

    const controls = document.createElement('div'); controls.className = 'controls';
    const doneLabel = document.createElement('label'); doneLabel.className = 'done';
    const checkbox = document.createElement('input'); checkbox.type='checkbox';
    checkbox.checked = !!state.done[globalIndex];
    checkbox.addEventListener('change', (e)=>{
      state.done[globalIndex] = e.target.checked;
      save();
      updateCardMark(card, globalIndex);
    });
    doneLabel.appendChild(checkbox);
    doneLabel.appendChild(document.createTextNode('Выполнено'));
    const meta = document.createElement('div'); meta.style.textAlign='right';
    meta.innerHTML = '<div class="small">День ' + label + '</div>';
    controls.appendChild(doneLabel); controls.appendChild(meta);
    back.appendChild(task); back.appendChild(controls);

    inner.appendChild(front); inner.appendChild(back);
    card.appendChild(inner);

    // initial open state
    if(state.opened[globalIndex]){
      card.classList.add('open');
      inner.style.transform = 'rotateY(180deg)';
    }

    // click to open
    card.addEventListener('click', (ev)=>{
      if(ev.target.tagName.toLowerCase() === 'input') return;
      if(!state.opened[globalIndex]){
        state.opened[globalIndex] = true;
        save();
      }
      card.classList.toggle('open');
      if(card.classList.contains('open')){
        inner.style.transform = 'rotateY(180deg)';
      } else {
        inner.style.transform = '';
      }
    });

    updateCardMark(card, globalIndex);
    return card;
  }

  function updateCardMark(card, idx){
    if(state.done[idx]){
      card.style.border = '2px solid rgba(42,157,143,0.18)';
      const f = card.querySelector('.front');
      if(f) f.style.opacity = '0.7';
    } else {
      card.style.border = '';
      const f = card.querySelector('.front');
      if(f) f.style.opacity = '1';
    }
  }

  function render(){
    grid.innerHTML = '';
    bonusGrid.innerHTML = '';

    // render main tasks 1..24 (global indices 0..23)
    for(let i=0;i<mainTasks.length;i++){
      grid.appendChild(createCard(i, i+1, mainTasks[i]));
    }

    // render bonus 25..31 (global indices 24..30)
    for(let j=0;j<bonusTasks.length;j++){
      const globalIndex = mainTasks.length + j; // 24..30
      const label = 25 + j;
      bonusGrid.appendChild(createCard(globalIndex, label, bonusTasks[j]));
    }

    updateProgress();
    // set focusability for keyboard
    document.querySelectorAll('.card').forEach((c)=>c.setAttribute('tabindex','0'));
  }

  function updateProgress(){
    const total = mainTasks.length + bonusTasks.length; // 31
    const openedCount = Object.keys(state.opened).filter(k=>state.opened[k]).length;
    const doneCount = Object.keys(state.done).filter(k=>state.done[k]).length;
    progressEl.textContent = `Открыто ${openedCount} из ${total}. Выполнено: ${doneCount}.`;
  }

  resetBtn.addEventListener('click', ()=>{
    if(!confirm('Сбросить сохранённый прогресс? (открытые окна и отметки будут удалены)')) return;
    state = { opened: {}, done: {} };
    save();
    render();
  });

  printBtn.addEventListener('click', ()=> window.print());

  revealTodayBtn.addEventListener('click', ()=>{
    // вычислим «сегодня» как число между 1 и 31
    const now = new Date();
    let dayOfMonth = now.getDate(); // 1..31
    let day = Math.min(31, Math.max(1, dayOfMonth));
    const idx = day - 1;
    state.opened[idx] = true;
    save();
    const card = document.querySelector('.card[data-day="'+day+'"]');
    if(card){
      card.classList.add('open');
      card.querySelector('.inner').style.transform = 'rotateY(180deg)';
      card.scrollIntoView({behavior:'smooth',block:'center'});
    }
  });

  // accessibility: open with Enter when focused
  document.addEventListener('keydown', (e)=>{
    if(e.key === 'Enter' && document.activeElement && document.activeElement.classList.contains('card')){
      document.activeElement.click();
    }
  });

  render();
})();
</script>
</body>
</html>
