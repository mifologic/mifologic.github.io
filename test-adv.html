<!doctype html>
<html lang="ru">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Адвент: забота о себе</title>
<style>
  :root{
    --bg:#f7f4f2;
    --card:#fff;
    --accent:#6b4f9f;
    --muted:#7a7a7a;
    --ok:#2a9d8f;
    --shadow: 0 6px 18px rgba(12,12,12,0.08);
    font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
  }

  html,body{height:100%;margin:0;background:linear-gradient(180deg,var(--bg),#eef0f2 100%);color:#222}
  .wrap{max-width:980px;margin:28px auto;padding:18px;}
  header{display:flex;align-items:center;justify-content:space-between;gap:12px}
  h1{font-size:20px;margin:0;color:var(--accent)}
  p.lead{margin:6px 0 18px;color:var(--muted);font-size:14px}
  .grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(120px,1fr));gap:14px}

  /* ✅ БОЛЬШЕ НЕТ ЖЁСТКОЙ ВЫСОТЫ */
  .card{
    perspective:800px;
    height:auto;
  }

  .inner{
    position:relative;
    width:100%;
    height:auto;
    min-height:190px;
    border-radius:10px;
    background:var(--card);
    box-shadow:var(--shadow);
    cursor:pointer;
    transform-style:preserve-3d;
    transition:transform .6s;
  }

  .card.open .inner{transform:rotateY(180deg)}

  .face{
    position:absolute;
    inset:0;
    backface-visibility:hidden;
    border-radius:10px;
    display:flex;
    align-items:center;
    justify-content:center;
    padding:14px;
  }

  .front{
    background:linear-gradient(180deg,#fff,var(--card));
    font-weight:700;
    color:var(--accent);
    font-size:22px;
  }

  .front .num{font-size:32px}

  .back{
    transform:rotateY(180deg);
    text-align:left;
    padding:16px;
    font-size:14px;
    color:#222;
    display:flex;
    flex-direction:column;
    gap:10px;
    justify-content:space-between;
  }

  .task{line-height:1.35}

  .controls{
    display:flex;
    gap:8px;
    align-items:center;
    justify-content:space-between;
  }

  .btn{
    padding:8px 10px;
    border-radius:8px;
    border:0;
    background:var(--accent);
    color:white;
    font-weight:600;
    cursor:pointer;
    box-shadow:0 4px 10px rgba(107,79,159,0.15);
  }

  .btn.secondary{background:#eee;color:#333;font-weight:600}
  .small{font-size:13px;color:var(--muted)}
  .done{display:inline-flex;align-items:center;gap:8px;font-size:13px}
  .done input{width:18px;height:18px}

  footer{margin-top:18px;display:flex;align-items:center;justify-content:space-between;gap:10px}
  .progress{font-size:13px;color:var(--muted)}
  .reset{background:transparent;border:0;color:var(--muted);cursor:pointer;text-decoration:underline;font-size:13px}

  @media (max-width:520px){
    .front .num{font-size:26px}
  }

  @media print{
    body{background:white}
    .btn,.reset{display:none}
    .inner{box-shadow:none}
    .grid{gap:6px}
    .card{page-break-inside:avoid;break-inside:avoid;}
  }
</style>
</head>

<body>
<div class="wrap" role="main">
<header>
  <div>
    <h1>Адвент — забота о себе</h1>
    <p class="lead">Короткие задания 1–5 минут. Прогресс сохраняется.</p>
  </div>
  <button class="btn" id="revealToday">Открыть сегодня</button>
</header>

<section class="grid" id="grid"></section>

<footer>
  <div class="progress" id="progress">Открыто 0 из 24</div>
  <div style="display:flex;gap:8px">
    <button class="btn secondary" id="printBtn">Печать</button>
    <button class="reset" id="resetBtn">Сбросить прогресс</button>
  </div>
</footer>
</div>

<script>
(function(){
  const tasks = [
    "Запиши одну вещь, которая в тебе укрепилась за год.",
    "Выбери маленький жест заботы о теле: выпей воду, сделай 3 глубоких вдоха или потянись.",
    "Вспомни момент, когда ты гордилась собой — опиши его тремя словами.",
    "Паузa у окна на 2 минуты: смотри и дыши, без телефона.",
    "Подумай, кто была опорой в этом году, и мысленно поблагодари.",
    "Запиши одну привычку, которую хочешь мягко укрепить в следующем году.",
    "Сделай маленькую сенсорную радость: тёплый напиток, любимый запах или плед.",
    "Выбери фото за год, которое хочется сохранить как символ тёплого момента.",
    "Положи руку на грудь и сделай 5 медленных вдохов.",
    "Спроси себя: «Что мне нужно прямо сейчас?» — и сделай минимальный шаг.",
    "Запиши три маленькие удачи этого года.",
    "Останься в прямой осанке 1 минуту — почувствуй дыхание.",
    "Тишина на 1 минуту — без задач и телефона.",
    "Выпиши три вещи, которые хочешь оставить в уходящем году.",
    "Вспомни, кому ты принесла добро — даже мелкое.",
    "Выбери одно упрощение на сегодня.",
    "Запиши одну мечту без обязательств.",
    "Микро-расхламление: убери одну вещь.",
    "Составь мини-плейлист из трёх треков.",
    "Вспомни момент покоя в этом году.",
    "Проверь базовые потребности: вода, воздух.",
    "Запиши маленькое «да», которое сказала себе.",
    "Сделай 30 секунд растяжки.",
    "Назови одну вещь для себя в новом году."
  ];

  const grid = document.getElementById('grid');
  const progressEl = document.getElementById('progress');
  const resetBtn = document.getElementById('resetBtn');
  const printBtn = document.getElementById('printBtn');
  const revealTodayBtn = document.getElementById('revealToday');

  const STORAGE_KEY = 'advent-autoresize-v1';
  let state = { opened: {}, done: {} };

  try{
    const raw = localStorage.getItem(STORAGE_KEY);
    if(raw) state = JSON.parse(raw);
  }catch(e){}

  function save(){ localStorage.setItem(STORAGE_KEY, JSON.stringify(state)); updateProgress(); }

  function autoResize(card){
    const front = card.querySelector('.front');
    const back = card.querySelector('.back');
    const inner = card.querySelector('.inner');

    const maxH = Math.max(front.scrollHeight, back.scrollHeight);
    inner.style.minHeight = maxH + 16 + 'px';
  }

  function createCard(i, text){
    const card = document.createElement('div');
    card.className = 'card';
    card.dataset.day = i+1;

    const inner = document.createElement('div');
    inner.className = 'inner';

    const front = document.createElement('div');
    front.className = 'face front';
    front.innerHTML = `<div class="num">${i+1}</div>`;

    const back = document.createElement('div');
    back.className = 'face back';

    const task = document.createElement('div');
    task.className='task';
    task.textContent=text;

    const controls = document.createElement('div');
    controls.className='controls';

    const done = document.createElement('label');
    done.className='done';

    const check = document.createElement('input');
    check.type='checkbox';
    check.checked=!!state.done[i];
    check.onchange=()=>{
      state.done[i]=check.checked;
      save();
    };

    done.append(check, document.createTextNode('Выполнено'));

    const meta = document.createElement('div');
    meta.className='small';
    meta.textContent='День '+(i+1);

    controls.append(done, meta);
    back.append(task, controls);

    inner.append(front, back);
    card.append(inner);

    if(state.opened[i]){
      card.classList.add('open');
      inner.style.transform='rotateY(180deg)';
    }

    card.onclick=(e)=>{
      if(e.target.tagName==='INPUT') return;
      state.opened[i]=true;
      card.classList.toggle('open');
      inner.style.transform=card.classList.contains('open')?'rotateY(180deg)':'';
      save();
    };

    setTimeout(()=>autoResize(card), 0);
    return card;
  }

  function updateProgress(){
    const opened = Object.keys(state.opened).length;
    const done = Object.keys(state.done).length;
    progressEl.textContent = `Открыто ${opened} из ${tasks.length}. Выполнено: ${done}.`;
  }

  function render(){
    grid.innerHTML='';
    tasks.forEach((t,i)=>grid.appendChild(createCard(i,t)));
    updateProgress();
  }

  resetBtn.onclick=()=>{
    if(confirm('Сбросить прогресс?')){
      state={opened:{},done:{}};
      save();
      render();
    }
  };

  printBtn.onclick=()=>window.print();

  revealTodayBtn.onclick=()=>{
    const d=Math.min(new Date().getDate(),24)-1;
    state.opened[d]=true;
    save();
    const card=grid.querySelector(`[data-day="${d+1}"]`);
    if(card){
      card.classList.add('open');
      card.querySelector('.inner').style.transform='rotateY(180deg)';
      card.scrollIntoView({behavior:'smooth',block:'center'});
    }
  };

  render();
})();
</script>
</body>
</html>
